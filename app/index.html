<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDL Protocol - Stake | Vote | Bet | Earn</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/src/theme.css">
    <style>
        /* App-specific CSS variables for protocol UI */
        :root {
            --accent-green: #3fb950;
            --accent-purple: #a371f7;
            --accent-orange: #d29922;
            --accent-pink: #db61a2;
            --success-color: #3fb950;
            --warning-color: #d29922;
        }

        [data-theme="light"] {
            --accent-green: #1a7f37;
            --accent-purple: #8250df;
            --accent-orange: #9a6700;
            --accent-pink: #bf3989;
        }

        /* Main Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-secondary);
            min-height: 100vh;
            border-left: 1px solid var(--border-secondary);
            border-right: 1px solid var(--border-secondary);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 16px 24px;
            border-bottom: 2px solid var(--border-primary);
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header h1 {
            font-size: 16px;
            margin: 0;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }

        .header h1::before {
            content: '> ';
            color: var(--accent-primary);
        }

        .header p {
            font-size: 12px;
            color: var(--text-secondary);
            margin: 4px 0 0 0;
        }

        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nav-links {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nav-link {
            padding: 4px 12px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
            border: 1px solid var(--border-secondary);
            background: var(--bg-secondary);
        }

        .nav-link:hover {
            background: var(--accent-hover);
            color: var(--bg-secondary);
        }

        .nav-link.active {
            background: var(--accent-primary);
            color: var(--bg-secondary);
            border-color: var(--accent-primary);
        }

        .theme-selector {
            position: relative;
        }

        .theme-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            color: var(--text-primary);
            padding: 4px 12px;
            border-radius: 0;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.1s;
            font-weight: 600;
            font-family: inherit;
        }

        .theme-btn:hover {
            background: var(--accent-hover);
            color: var(--bg-secondary);
        }

        .theme-btn::before {
            content: '[';
        }

        .theme-btn::after {
            content: ']';
        }

        .theme-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            margin-top: 4px;
            min-width: 180px;
            z-index: 1000;
        }

        .theme-dropdown.active {
            display: block;
        }

        .theme-option {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 11px;
            text-transform: uppercase;
            font-weight: 600;
            border-bottom: 1px solid var(--border-secondary);
            transition: all 0.1s;
            color: var(--text-primary);
        }

        .theme-option:last-child {
            border-bottom: none;
        }

        .theme-option:hover {
            background: var(--bg-tertiary);
        }

        .theme-option.selected {
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-primary);
            padding-left: 13px;
        }

        .stats {
            display: flex;
            gap: 32px;
            padding: 12px 0 0 0;
            font-size: 11px;
        }

        .stat {
            display: flex;
            align-items: baseline;
            gap: 6px;
        }

        .stat::before {
            content: '|';
            color: var(--border-secondary);
            margin-right: 6px;
        }

        .stat:first-child::before {
            content: '';
            margin-right: 0;
        }

        .stat-number {
            font-size: 14px;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* Main Content Container */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 24px 40px;
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0;
            margin-bottom: 16px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
            border-radius: 0;
            padding: 12px 16px;
            border-right: none;
        }

        .stat-card:first-child {
            border-left: 1px solid var(--border-secondary);
        }

        .stat-card:last-child {
            border-right: 1px solid var(--border-secondary);
        }

        .stat-card:hover {
            background: var(--bg-tertiary);
        }

        .stat-card .stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .stat-card .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .stat-card .stat-change {
            font-size: 10px;
            margin-top: 4px;
            color: var(--text-secondary);
        }

        .stat-card .stat-change.positive {
            color: var(--accent-green);
        }

        .stat-card .stat-change.negative {
            color: var(--error-color);
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            background: var(--bg-secondary);
            padding: 12px 24px;
            border-radius: 0;
            border-bottom: 1px solid var(--border-secondary);
        }

        .tab-btn {
            flex: 1;
            padding: 5px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
            border-radius: 0;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: inherit;
        }

        .tab-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        .tab-btn.active {
            background: var(--accent-primary);
            color: var(--bg-secondary);
            border-color: var(--accent-primary);
        }

        .tab-icon {
            font-size: 14px;
        }

        /* Content Sections */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Section Card */
        .section-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 0;
            padding: 20px 24px;
            margin-bottom: 16px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-secondary);
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .section-title::before {
            content: '> ';
            color: var(--accent-primary);
        }

        .section-subtitle {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 4px;
            text-transform: uppercase;
        }

        /* Staking Section */
        .stake-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .stake-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
            border-radius: 0;
            padding: 20px;
        }

        .stake-box-title {
            font-size: 12px;
            color: var(--text-primary);
            margin-bottom: 16px;
            text-transform: uppercase;
            font-weight: 700;
            border-bottom: 1px solid var(--border-secondary);
            padding-bottom: 8px;
        }

        .stake-box-title::before {
            content: '[ ';
            color: var(--accent-primary);
        }

        .stake-box-title::after {
            content: ' ]';
            color: var(--accent-primary);
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
            display: block;
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 0;
            overflow: hidden;
        }

        .input-wrapper:focus-within {
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        .input-field {
            flex: 1;
            padding: 8px 12px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            outline: none;
            font-family: inherit;
        }

        .input-field::placeholder {
            color: var(--text-muted);
        }

        .input-suffix {
            padding: 8px 12px;
            color: var(--text-secondary);
            font-weight: 600;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-primary);
            font-size: 11px;
            text-transform: uppercase;
        }

        .max-btn {
            padding: 4px 12px;
            margin-right: 0;
            background: var(--accent-primary);
            color: var(--bg-secondary);
            border: none;
            border-radius: 0;
            font-size: 10px;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.1s;
            font-family: inherit;
        }

        .max-btn:hover {
            background: var(--accent-hover);
        }

        .stake-info {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-primary);
            font-size: 14px;
        }

        .stake-info:last-child {
            border-bottom: none;
        }

        .stake-info-label {
            color: var(--text-secondary);
        }

        .stake-info-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .action-btn {
            width: 100%;
            padding: 10px 16px;
            background: var(--accent-primary);
            color: var(--bg-secondary);
            border: 1px solid var(--accent-primary);
            border-radius: 0;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.1s;
            margin-top: 16px;
            text-transform: uppercase;
            font-family: inherit;
        }

        .action-btn:hover {
            background: var(--accent-hover);
            border-color: var(--accent-hover);
        }

        .action-btn:disabled {
            background: var(--bg-tertiary);
            color: var(--text-muted);
            cursor: not-allowed;
            border-color: var(--border-secondary);
        }

        .action-btn.secondary {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            color: var(--text-primary);
        }

        .action-btn.secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        /* Vote Section */
        .vote-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0;
            margin-bottom: 16px;
        }

        .vote-stat {
            text-align: center;
            padding: 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
            border-right: none;
            border-radius: 0;
        }

        .vote-stat:first-child {
            border-left: 1px solid var(--border-secondary);
        }

        .vote-stat:last-child {
            border-right: 1px solid var(--border-secondary);
        }

        .vote-stat:hover {
            background: var(--bg-tertiary);
        }

        .vote-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-purple);
        }

        .vote-stat-label {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .proposal-list {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .proposal-card {
            background: var(--bg-secondary);
            border-radius: 0;
            padding: 16px 20px;
            border: 1px solid var(--border-secondary);
            border-top: none;
            cursor: pointer;
            transition: all 0.1s;
        }

        .proposal-card:first-child {
            border-top: 1px solid var(--border-secondary);
        }

        .proposal-card:hover {
            background: var(--bg-tertiary);
        }

        .proposal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .proposal-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .proposal-status {
            padding: 2px 8px;
            border-radius: 0;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            border: 1px solid;
        }

        .proposal-status.active {
            background: var(--bg-secondary);
            color: var(--accent-green);
            border-color: var(--accent-green);
        }

        .proposal-status.ended {
            background: var(--bg-secondary);
            color: var(--text-muted);
            border-color: var(--border-secondary);
        }

        .proposal-status.pending {
            background: var(--bg-secondary);
            color: var(--accent-orange);
            border-color: var(--accent-orange);
        }

        .proposal-description {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .proposal-votes {
            display: flex;
            gap: 20px;
        }

        .vote-bar {
            flex: 1;
        }

        .vote-bar-header {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .vote-bar-label {
            color: var(--text-secondary);
            font-weight: 600;
        }

        .vote-bar-value {
            font-weight: 700;
            color: var(--text-primary);
        }

        .vote-bar-track {
            height: 6px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            border-radius: 0;
            overflow: hidden;
        }

        .vote-bar-fill {
            height: 100%;
            border-radius: 0;
            transition: width 0.3s ease;
        }

        .vote-bar-fill.yes {
            background: var(--accent-green);
        }

        .vote-bar-fill.no {
            background: var(--error-color);
        }

        /* Betting Section */
        .markets-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .market-card {
            background: var(--bg-secondary);
            border-radius: 0;
            padding: 16px;
            border: 1px solid var(--border-secondary);
            transition: all 0.1s;
        }

        .market-card:hover {
            background: var(--bg-tertiary);
        }

        .market-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .market-protocol {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .protocol-icon {
            width: 32px;
            height: 32px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .protocol-name {
            font-weight: 700;
            font-size: 13px;
            color: var(--text-primary);
        }

        .market-metric {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: 600;
        }

        .market-timer {
            font-size: 10px;
            color: var(--accent-orange);
            display: flex;
            align-items: center;
            gap: 4px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .market-question {
            font-size: 13px;
            color: var(--text-primary);
            margin-bottom: 12px;
            line-height: 1.5;
            font-weight: 600;
        }

        .market-odds {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        .odds-btn {
            padding: 10px;
            border-radius: 0;
            border: 1px solid var(--border-primary);
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.1s;
            text-align: center;
        }

        .odds-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        .odds-btn.yes:hover {
            border-color: var(--accent-green);
        }

        .odds-btn.no:hover {
            border-color: var(--error-color);
        }

        .odds-label {
            font-size: 10px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .odds-value {
            font-size: 18px;
            font-weight: 700;
        }

        .odds-btn.yes .odds-value {
            color: var(--accent-green);
        }

        .odds-btn.no .odds-value {
            color: var(--error-color);
        }

        .market-pool {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--text-muted);
            padding-top: 12px;
            border-top: 1px solid var(--border-secondary);
            font-weight: 600;
        }

        /* Badges Section */
        .badges-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .badges-progress {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .progress-text {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-weight: 600;
        }

        .progress-bar {
            width: 200px;
            height: 6px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            border-radius: 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-primary);
            border-radius: 0;
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .badge-card {
            background: var(--bg-secondary);
            border-radius: 0;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border-secondary);
            transition: all 0.1s;
            position: relative;
        }

        .badge-card:hover {
            background: var(--bg-tertiary);
        }

        .badge-card.locked {
            opacity: 0.5;
        }

        .badge-card.earned {
            border-color: var(--accent-primary);
            background: var(--bg-tertiary);
        }

        .badge-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .badge-card.earned .badge-icon {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .badge-name {
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--text-primary);
            text-transform: uppercase;
        }

        .badge-requirement {
            font-size: 10px;
            color: var(--text-muted);
        }

        .badge-progress {
            margin-top: 8px;
            font-size: 10px;
            color: var(--accent-primary);
            font-weight: 600;
        }

        .badge-check {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 16px;
            height: 16px;
            background: var(--accent-green);
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg-secondary);
            font-size: 10px;
            font-weight: 900;
        }

        /* Rewards Panel */
        .rewards-panel {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-primary);
            border-radius: 0;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .rewards-info h3 {
            font-size: 14px;
            margin-bottom: 4px;
            font-weight: 700;
            color: var(--text-primary);
            text-transform: uppercase;
        }

        .rewards-info h3::before {
            content: '[ ';
            color: var(--accent-primary);
        }

        .rewards-info h3::after {
            content: ' ]';
            color: var(--accent-primary);
        }

        .rewards-info p {
            color: var(--text-secondary);
            font-size: 11px;
            text-transform: uppercase;
        }

        .rewards-amount {
            text-align: right;
        }

        .rewards-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-green);
        }

        .rewards-usd {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* Footer */
        .footer {
            padding: 16px 24px;
            background: var(--bg-secondary);
            border-top: 2px solid var(--border-primary);
            text-align: center;
            color: var(--text-secondary);
            font-size: 10px;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .footer a {
            color: var(--accent-primary);
            text-decoration: none;
            font-weight: 600;
        }

        .footer a::before {
            content: '[';
            color: var(--border-primary);
        }

        .footer a::after {
            content: ']';
            color: var(--border-primary);
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            .stake-grid {
                grid-template-columns: 1fr;
            }
            .markets-grid {
                grid-template-columns: 1fr;
            }
            .badges-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 14px;
            }

            .stats {
                flex-direction: column;
                gap: 8px;
            }

            .tab-nav {
                flex-wrap: wrap;
            }
            .tab-btn {
                flex: 1 1 45%;
            }
            .stats-bar {
                grid-template-columns: 1fr;
            }
            .vote-stats {
                grid-template-columns: 1fr;
            }
            .badges-grid {
                grid-template-columns: 1fr;
            }
            .nav-links {
                flex-wrap: wrap;
            }
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .live-dot {
            width: 6px;
            height: 6px;
            background: var(--accent-green);
            border-radius: 0;
            animation: pulse 2s infinite;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
            font-size: 12px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--bg-tertiary);
            border-top: 3px solid var(--border-primary);
            border-radius: 0;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-primary);
            border-radius: 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .toast.success::before {
            content: '[OK]';
            margin-right: 4px;
        }

        .toast.error {
            border-color: var(--error-color);
            color: var(--error-color);
        }

        .toast.error::before {
            content: '[ERR]';
            margin-right: 4px;
        }
    </style>
</head>

<body>
    <div class="container">
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <div>
                    <h1>idlhub.com</h1>
                    <p>Solana IDL Registry</p>
                </div>
            </div>
            <div class="header-actions">
                <nav class="nav-links">
                    <a href="/app/registry" class="nav-link">Registry</a>
                    <a href="/app/" class="nav-link active">Protocol</a>
                    <a href="/app/status" class="nav-link">Status</a>
                    <a href="/docs" class="nav-link">Docs</a>
                    <a href="/tokenomics" class="nav-link">$IDL</a>
                </nav>
                <div class="theme-selector">
                    <button class="theme-btn" onclick="toggleThemeDropdown()">
                        <span id="currentTheme">Theme</span>
                    </button>
                    <div class="theme-dropdown" id="themeDropdown">
                        <div class="theme-option selected" data-theme="light">Light</div>
                        <div class="theme-option" data-theme="dark">Dark</div>
                        <div class="theme-option" data-theme="solarized">Solarized</div>
                        <div class="theme-option" data-theme="solarized-light">Solarized Light</div>
                        <div class="theme-option" data-theme="monokai-light">Monokai Light</div>
                        <div class="theme-option" data-theme="night">Night</div>
                        <div class="theme-option" data-theme="dracula">Dracula</div>
                        <div class="theme-option" data-theme="nord">Nord</div>
                        <div class="theme-option" data-theme="onedark">One Dark</div>
                        <div class="theme-option" data-theme="terminal">Terminal</div>
                        <div class="theme-option" data-theme="dos">DOS / Borland</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="stats">
            <div class="stat">
                <div class="stat-number" id="totalProtocols">-</div>
                <div class="stat-label">Total Protocols</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="availableProtocols">-</div>
                <div class="stat-label">IDLs Available</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="selectedCount">0</div>
                <div class="stat-label">Selected</div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-label">Your IDL Balance</div>
                <div class="stat-value" id="idlBalance">0.00</div>
                <div class="stat-change positive">+2.4% today</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Staked IDL</div>
                <div class="stat-value" id="stakedBalance">0.00</div>
                <div class="stat-change positive">Earning 12.5% APY</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">veIDL Power</div>
                <div class="stat-value" id="veBalance">0.00</div>
                <div class="stat-change">4 proposals active</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Badges Earned</div>
                <div class="stat-value" id="badgeCount">0 / 12</div>
                <div class="stat-change">Next: Early Adopter</div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="showTab('stake')">
                Stake
            </button>
            <button class="tab-btn" onclick="showTab('vote')">
                Vote
            </button>
            <button class="tab-btn" onclick="showTab('bet')">
                Bet
            </button>
            <button class="tab-btn" onclick="showTab('badges')">
                Badges
            </button>
        </div>

        <!-- STAKE TAB -->
        <div class="tab-content active" id="tab-stake">
            <!-- Rewards Panel -->
            <div class="rewards-panel section-card">
                <div class="rewards-info">
                    <h3>Claimable Rewards</h3>
                    <p>From staking and prediction market fees</p>
                </div>
                <div class="rewards-amount">
                    <div class="rewards-value" id="claimableRewards">0.00 IDL</div>
                    <div class="rewards-usd">~$0.00 USD</div>
                </div>
                <button class="action-btn" style="width: auto; margin: 0; padding: 12px 32px;" onclick="claimRewards()">
                    Claim Rewards
                </button>
            </div>

            <div class="section-card">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Stake IDL Tokens</h2>
                        <p class="section-subtitle">Earn protocol fees and unlock betting bonuses up to 50%</p>
                    </div>
                </div>

                <div class="stake-grid">
                    <!-- Stake Box -->
                    <div class="stake-box">
                        <div class="stake-box-title">Stake IDL</div>
                        <div class="input-group">
                            <label class="input-label">Amount to stake</label>
                            <div class="input-wrapper">
                                <input type="number" class="input-field" id="stakeAmount" placeholder="0.00">
                                <button class="max-btn" onclick="setMaxStake()">MAX</button>
                                <span class="input-suffix">IDL</span>
                            </div>
                        </div>
                        <div class="stake-info">
                            <span class="stake-info-label">Available Balance</span>
                            <span class="stake-info-value" id="availableStake">0.00 IDL</span>
                        </div>
                        <div class="stake-info">
                            <span class="stake-info-label">Current APY</span>
                            <span class="stake-info-value" style="color: var(--accent-green)">12.5%</span>
                        </div>
                        <div class="stake-info">
                            <span class="stake-info-label">Betting Bonus</span>
                            <span class="stake-info-value" id="stakingBonus">0%</span>
                        </div>
                        <button class="action-btn" onclick="stakeTokens()">Stake IDL</button>
                    </div>

                    <!-- Lock for veIDL Box -->
                    <div class="stake-box">
                        <div class="stake-box-title">Lock for veIDL</div>
                        <div class="input-group">
                            <label class="input-label">Lock duration</label>
                            <div class="input-wrapper">
                                <select class="input-field" id="lockDuration" style="cursor: pointer;">
                                    <option value="7">1 Week (1x veIDL)</option>
                                    <option value="30">1 Month (1.5x veIDL)</option>
                                    <option value="90">3 Months (2x veIDL)</option>
                                    <option value="365">1 Year (3x veIDL)</option>
                                    <option value="1460">4 Years (4x veIDL)</option>
                                </select>
                            </div>
                        </div>
                        <div class="stake-info">
                            <span class="stake-info-label">Your Staked IDL</span>
                            <span class="stake-info-value" id="lockedStake">0.00 IDL</span>
                        </div>
                        <div class="stake-info">
                            <span class="stake-info-label">veIDL You'll Receive</span>
                            <span class="stake-info-value" style="color: var(--accent-purple)" id="veIdlPreview">0.00 veIDL</span>
                        </div>
                        <div class="stake-info">
                            <span class="stake-info-label">Voting Power Boost</span>
                            <span class="stake-info-value">1.0x</span>
                        </div>
                        <button class="action-btn" onclick="lockTokens()">Lock for veIDL</button>
                        <button class="action-btn secondary" onclick="unstakeTokens()" style="margin-top: 8px;">Unstake IDL</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- VOTE TAB -->
        <div class="tab-content" id="tab-vote">
            <div class="section-card">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Governance</h2>
                        <p class="section-subtitle">Vote on protocol proposals with your veIDL</p>
                    </div>
                    <button class="action-btn" style="width: auto; padding: 12px 24px;">Create Proposal</button>
                </div>

                <div class="vote-stats">
                    <div class="vote-stat">
                        <div class="vote-stat-value" id="votingPower">0</div>
                        <div class="vote-stat-label">Your Voting Power</div>
                    </div>
                    <div class="vote-stat">
                        <div class="vote-stat-value">4</div>
                        <div class="vote-stat-label">Active Proposals</div>
                    </div>
                    <div class="vote-stat">
                        <div class="vote-stat-value">23</div>
                        <div class="vote-stat-label">Total Proposals</div>
                    </div>
                </div>

                <div class="proposal-list">
                    <div class="proposal-card" onclick="openProposal(1)">
                        <div class="proposal-header">
                            <h3 class="proposal-title">IDP-12: Increase Staking Rewards to 15% APY</h3>
                            <span class="proposal-status active">Active</span>
                        </div>
                        <p class="proposal-description">Proposal to increase base staking rewards from 12.5% to 15% APY by allocating additional protocol fees to stakers.</p>
                        <div class="proposal-votes">
                            <div class="vote-bar">
                                <div class="vote-bar-header">
                                    <span class="vote-bar-label">Yes</span>
                                    <span class="vote-bar-value">67.3%</span>
                                </div>
                                <div class="vote-bar-track">
                                    <div class="vote-bar-fill yes" style="width: 67.3%"></div>
                                </div>
                            </div>
                            <div class="vote-bar">
                                <div class="vote-bar-header">
                                    <span class="vote-bar-label">No</span>
                                    <span class="vote-bar-value">32.7%</span>
                                </div>
                                <div class="vote-bar-track">
                                    <div class="vote-bar-fill no" style="width: 32.7%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="proposal-card" onclick="openProposal(2)">
                        <div class="proposal-header">
                            <h3 class="proposal-title">IDP-11: Add Jupiter Integration for Oracles</h3>
                            <span class="proposal-status active">Active</span>
                        </div>
                        <p class="proposal-description">Integrate Jupiter price feeds as an additional oracle source for prediction market resolution.</p>
                        <div class="proposal-votes">
                            <div class="vote-bar">
                                <div class="vote-bar-header">
                                    <span class="vote-bar-label">Yes</span>
                                    <span class="vote-bar-value">89.1%</span>
                                </div>
                                <div class="vote-bar-track">
                                    <div class="vote-bar-fill yes" style="width: 89.1%"></div>
                                </div>
                            </div>
                            <div class="vote-bar">
                                <div class="vote-bar-header">
                                    <span class="vote-bar-label">No</span>
                                    <span class="vote-bar-value">10.9%</span>
                                </div>
                                <div class="vote-bar-track">
                                    <div class="vote-bar-fill no" style="width: 10.9%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="proposal-card" onclick="openProposal(3)">
                        <div class="proposal-header">
                            <h3 class="proposal-title">IDP-10: Reduce Market Creation Fee to 1%</h3>
                            <span class="proposal-status ended">Ended</span>
                        </div>
                        <p class="proposal-description">Lower the fee for creating new prediction markets from 2% to 1% to encourage more market creation.</p>
                        <div class="proposal-votes">
                            <div class="vote-bar">
                                <div class="vote-bar-header">
                                    <span class="vote-bar-label">Yes</span>
                                    <span class="vote-bar-value">45.2%</span>
                                </div>
                                <div class="vote-bar-track">
                                    <div class="vote-bar-fill yes" style="width: 45.2%"></div>
                                </div>
                            </div>
                            <div class="vote-bar">
                                <div class="vote-bar-header">
                                    <span class="vote-bar-label">No</span>
                                    <span class="vote-bar-value">54.8%</span>
                                </div>
                                <div class="vote-bar-track">
                                    <div class="vote-bar-fill no" style="width: 54.8%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BET TAB -->
        <div class="tab-content" id="tab-bet">
            <div class="section-card">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Prediction Markets</h2>
                        <p class="section-subtitle">Bet on Solana protocol metrics - TVL, volume, users & more</p>
                    </div>
                    <button class="action-btn" style="width: auto; padding: 12px 24px;" onclick="createMarket()">
                        + Create Market
                    </button>
                </div>

                <div class="markets-grid" id="marketsContainer">
                    <!-- Markets will be dynamically generated from real protocol metrics -->
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading prediction markets from real protocol data...
                    </div>
                </div>
            </div>

            <!-- Your Bets -->
            <div class="section-card">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Your Active Bets</h2>
                        <p class="section-subtitle">Track your positions across all markets</p>
                    </div>
                </div>
                <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                    <p>No active bets yet. Place your first bet above!</p>
                </div>
            </div>
        </div>

        <!-- BADGES TAB -->
        <div class="tab-content" id="tab-badges">
            <div class="section-card">
                <div class="badges-header">
                    <div>
                        <h2 class="section-title">Achievement Badges</h2>
                        <p class="section-subtitle">Earn badges for participating in the IDL ecosystem</p>
                    </div>
                    <div class="badges-progress">
                        <span class="progress-text">3 of 12 earned</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 25%"></div>
                        </div>
                    </div>
                </div>

                <div class="badges-grid">
                    <!-- Earned badges -->
                    <div class="badge-card earned">
                        <div class="badge-check">*</div>
                        <div class="badge-icon">[EA]</div>
                        <div class="badge-name">Early Adopter</div>
                        <div class="badge-requirement">Join during launch phase</div>
                    </div>

                    <div class="badge-card earned">
                        <div class="badge-check">*</div>
                        <div class="badge-icon">[FS]</div>
                        <div class="badge-name">First Stake</div>
                        <div class="badge-requirement">Stake any amount of IDL</div>
                    </div>

                    <div class="badge-card earned">
                        <div class="badge-check">*</div>
                        <div class="badge-icon">[FB]</div>
                        <div class="badge-name">First Bet</div>
                        <div class="badge-requirement">Place your first prediction</div>
                    </div>

                    <!-- Locked badges -->
                    <div class="badge-card">
                        <div class="badge-icon">[V]</div>
                        <div class="badge-name">Voter</div>
                        <div class="badge-requirement">Vote on 5 proposals</div>
                        <div class="badge-progress">0 / 5 votes</div>
                    </div>

                    <div class="badge-card">
                        <div class="badge-icon">[SS]</div>
                        <div class="badge-name">Sharpshooter</div>
                        <div class="badge-requirement">Win 10 predictions</div>
                        <div class="badge-progress">0 / 10 wins</div>
                    </div>

                    <div class="badge-card">
                        <div class="badge-icon">[W]</div>
                        <div class="badge-name">Whale</div>
                        <div class="badge-requirement">Stake 100,000+ IDL</div>
                        <div class="badge-progress">0 / 100,000 IDL</div>
                    </div>

                    <div class="badge-card">
                        <div class="badge-icon">[C]</div>
                        <div class="badge-name">Champion</div>
                        <div class="badge-requirement">Reach top 10 leaderboard</div>
                        <div class="badge-progress">Current rank: --</div>
                    </div>

                    <div class="badge-card">
                        <div class="badge-icon">[MM]</div>
                        <div class="badge-name">Market Maker</div>
                        <div class="badge-requirement">Create 3 markets</div>
                        <div class="badge-progress">0 / 3 markets</div>
                    </div>

                    <div class="badge-card locked">
                        <div class="badge-icon">[DH]</div>
                        <div class="badge-name">Diamond Hands</div>
                        <div class="badge-requirement">Lock veIDL for 1+ year</div>
                        <div class="badge-progress">Locked</div>
                    </div>

                    <div class="badge-card locked">
                        <div class="badge-icon">[HS]</div>
                        <div class="badge-name">Hot Streak</div>
                        <div class="badge-requirement">Win 5 bets in a row</div>
                        <div class="badge-progress">Locked</div>
                    </div>

                    <div class="badge-card locked">
                        <div class="badge-icon">[O]</div>
                        <div class="badge-name">Oracle</div>
                        <div class="badge-requirement">80%+ win rate (20+ bets)</div>
                        <div class="badge-progress">Locked</div>
                    </div>

                    <div class="badge-card locked">
                        <div class="badge-icon">[L]</div>
                        <div class="badge-name">Legend</div>
                        <div class="badge-requirement">Earn all other badges</div>
                        <div class="badge-progress">Locked</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>idlhub.com - Open source IDL registry for the Solana ecosystem  <a href="https://github.com/openSVM/idlhub" target="_blank">GitHub</a>  <a href="/docs.html">Documentation</a></p>
        <p style="margin-top: 10px; font-size: 12px;">Stake, Vote, and Bet on Protocol Metrics</p>
    </footer>
    </div>

    <!-- Toast Container -->
    <div class="toast" id="toast"></div>

    <!-- Bet Modal -->
    <div class="modal-overlay" id="betModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="betModalTitle">Place Bet</h3>
                <button class="modal-close" onclick="closeBetModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="bet-side-toggle">
                    <button class="bet-side-btn yes active" id="betYesBtn" onclick="selectBetSide(true)">YES</button>
                    <button class="bet-side-btn no" id="betNoBtn" onclick="selectBetSide(false)">NO</button>
                </div>
                <div class="input-group">
                    <label class="input-label">Bet Amount (IDL)</label>
                    <div class="input-wrapper">
                        <input type="number" class="input-field" id="betAmount" placeholder="0.00">
                        <button class="max-btn" onclick="setMaxBet()">MAX</button>
                        <span class="input-suffix">IDL</span>
                    </div>
                </div>
                <div class="bet-info">
                    <div class="stake-info">
                        <span class="stake-info-label">Your Balance</span>
                        <span class="stake-info-value" id="betBalance">0.00 IDL</span>
                    </div>
                    <div class="stake-info">
                        <span class="stake-info-label">Staking Bonus</span>
                        <span class="stake-info-value" id="betBonus">+0%</span>
                    </div>
                    <div class="stake-info">
                        <span class="stake-info-label">Effective Bet</span>
                        <span class="stake-info-value" id="effectiveBet">0.00 IDL</span>
                    </div>
                    <div class="stake-info">
                        <span class="stake-info-label">Potential Payout</span>
                        <span class="stake-info-value" style="color: var(--accent-green)" id="potentialPayout">0.00 IDL</span>
                    </div>
                </div>
                <button class="action-btn" id="confirmBetBtn" onclick="confirmBet()">Confirm Bet</button>
            </div>
        </div>
    </div>

    <!-- Create Market Modal -->
    <div class="modal-overlay" id="createMarketModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Create Prediction Market</h3>
                <button class="modal-close" onclick="closeCreateMarketModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label class="input-label">Protocol</label>
                    <div class="input-wrapper">
                        <select class="input-field" id="marketProtocol" style="cursor: pointer;">
                            <option value="jupiter">Jupiter</option>
                            <option value="raydium">Raydium</option>
                            <option value="marinade">Marinade</option>
                            <option value="orca">Orca</option>
                            <option value="drift">Drift</option>
                            <option value="pyth">Pyth</option>
                            <option value="tensor">Tensor</option>
                            <option value="magic-eden">Magic Eden</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">Metric Type</label>
                    <div class="input-wrapper">
                        <select class="input-field" id="marketMetricType" style="cursor: pointer;">
                            <option value="0">TVL</option>
                            <option value="1">24h Volume</option>
                            <option value="2">Unique Users</option>
                            <option value="3">Transactions</option>
                            <option value="4">Token Price</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">Target Value</label>
                    <div class="input-wrapper">
                        <input type="number" class="input-field" id="marketTargetValue" placeholder="1000000000">
                        <span class="input-suffix">USD</span>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">Resolution Date</label>
                    <div class="input-wrapper">
                        <input type="date" class="input-field" id="marketResolutionDate">
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">Description</label>
                    <div class="input-wrapper">
                        <input type="text" class="input-field" id="marketDescription" placeholder="Will Jupiter TVL exceed $1B?">
                    </div>
                </div>
                <button class="action-btn" onclick="confirmCreateMarket()">Create Market (0.1 SOL fee)</button>
            </div>
        </div>
    </div>

    <style>
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border: 2px solid var(--border-primary);
            border-radius: 0;
            max-width: 420px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 2px solid var(--border-primary);
            background: var(--bg-secondary);
        }

        .modal-header h3 {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-primary);
        }

        .modal-header h3::before {
            content: '> ';
            color: var(--accent-primary);
        }

        .modal-close {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            color: var(--text-primary);
            font-size: 16px;
            cursor: pointer;
            padding: 2px 8px;
            line-height: 1;
            font-weight: 700;
            transition: all 0.1s;
        }

        .modal-close:hover {
            background: var(--accent-hover);
            color: var(--bg-secondary);
        }

        .modal-body {
            padding: 20px;
        }

        .bet-side-toggle {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 16px;
        }

        .bet-side-btn {
            padding: 12px;
            border-radius: 0;
            border: 2px solid var(--border-primary);
            background: var(--bg-secondary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.1s;
            text-transform: uppercase;
            font-family: inherit;
        }

        .bet-side-btn.yes {
            color: var(--accent-green);
        }

        .bet-side-btn.no {
            color: var(--error-color);
        }

        .bet-side-btn.yes.active {
            border-color: var(--accent-green);
            background: var(--bg-tertiary);
        }

        .bet-side-btn.no.active {
            border-color: var(--error-color);
            background: var(--bg-tertiary);
        }

        .bet-info {
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
            border-radius: 0;
            padding: 16px;
            margin-bottom: 16px;
        }
    </style>

    <!-- Load Browser SDK -->
    <script src="/sdk-browser.js"></script>

    <script>
        // Theme management
        let currentTheme = 'light';

        function loadTheme() {
            const savedTheme = localStorage.getItem('idlhub-theme');
            if (savedTheme) {
                currentTheme = savedTheme;
            }
            applyTheme(currentTheme);
        }

        function applyTheme(theme) {
            currentTheme = theme;
            if (theme === 'light') {
                document.documentElement.removeAttribute('data-theme');
            } else {
                document.documentElement.setAttribute('data-theme', theme);
            }
            updateThemeSelector();
        }

        function saveTheme(theme) {
            localStorage.setItem('idlhub-theme', theme);
            applyTheme(theme);
        }

        function updateThemeSelector() {
            const options = document.querySelectorAll('.theme-option');
            options.forEach(option => {
                if (option.dataset.theme === currentTheme) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        function toggleThemeDropdown() {
            const dropdown = document.getElementById('themeDropdown');
            dropdown.classList.toggle('active');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const themeSelector = document.querySelector('.theme-selector');
            const dropdown = document.getElementById('themeDropdown');
            if (themeSelector && !themeSelector.contains(e.target)) {
                dropdown.classList.remove('active');
            }
        });

        // Theme option click handlers
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', () => {
                    saveTheme(option.dataset.theme);
                });
            });
            loadTheme();
        });

        // Initialize SDK
        let idlClient = null;

        // State
        let connected = false;
        let walletAddress = null;
        let userState = {
            idlBalance: 0,
            stakedAmount: 0,
            veAmount: 0,
            claimableRewards: 0,
            badges: ['early_adopter', 'first_stake', 'first_bet']
        };

        // Current bet state
        let currentBet = {
            market: null,
            marketPDA: null,
            betYes: true,
            yesPercent: 50,
            noPercent: 50,
            poolSize: 0
        };

        // Sample markets data (would come from chain in production)
        const marketsData = {
            'jupiter': { pda: 'JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN', yesPercent: 62, poolSize: 125430 },
            'raydium': { pda: 'RAYZuc2HRpPBpgzC5ExqNzPJ3tLfXaQL2TM5NmLT2oq', yesPercent: 34, poolSize: 89200 },
            'marinade': { pda: 'MARNdGrNwBPDuQJ1Guw9x5SFvJzNpxNLV5PLdHE1RoZ', yesPercent: 51, poolSize: 67850 },
            'pyth': { pda: 'PYTHnMrKujZLFqHTqCWu1B5HvzLHhToZ4fJbHMXcDjQ', yesPercent: 78, poolSize: 234100 }
        };

        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.closest('.tab-btn').classList.add('active');
        }

        // Wallet connection
        async function connectWallet() {
            const btn = document.getElementById('connectBtn');

            if (connected) {
                // Disconnect
                connected = false;
                walletAddress = null;
                btn.textContent = 'Connect Wallet';
                btn.classList.remove('connected');
                showToast('Wallet disconnected', 'success');
                updateUI();
                return;
            }

            // Check for Phantom
            if (window.solana && window.solana.isPhantom) {
                try {
                    // Initialize SDK
                    idlClient = new IdlBrowserClient();
                    walletAddress = await idlClient.connect();

                    connected = true;
                    btn.textContent = walletAddress.slice(0, 4) + '...' + walletAddress.slice(-4);
                    btn.classList.add('connected');
                    showToast('Wallet connected!', 'success');

                    // Fetch real user data
                    await fetchUserData();
                    updateUI();
                } catch (err) {
                    console.error('Connection error:', err);
                    showToast('Failed to connect wallet', 'error');
                }
            } else {
                showToast('Please install Phantom wallet', 'error');
                window.open('https://phantom.app/', '_blank');
            }
        }

        // Fetch user data from blockchain
        async function fetchUserData() {
            try {
                // Get SOL balance
                const solBalance = await idlClient.getBalance();

                // Get protocol state
                const protocolState = await idlClient.getProtocolState();

                // Get user's staker account
                const stakerAccount = await idlClient.getStakerAccount(walletAddress);

                // Get vePosition
                const vePosition = await idlClient.getVePosition(walletAddress);

                // Update state with real data (or demo data if not found)
                userState = {
                    solBalance: solBalance,
                    idlBalance: stakerAccount?.stakedAmount ? 10000 - (stakerAccount.stakedAmount / 1e6) : 10000,
                    stakedAmount: stakerAccount?.stakedAmount ? stakerAccount.stakedAmount / 1e6 : 0,
                    veAmount: vePosition?.veAmount ? vePosition.veAmount / 1e6 : 0,
                    claimableRewards: 0, // Would calculate from staking rewards
                    badges: ['early_adopter', 'first_stake', 'first_bet'],
                    protocolState: protocolState
                };

                // If no on-chain data, use demo values
                if (!stakerAccount) {
                    userState.idlBalance = 10000;
                    userState.stakedAmount = 5000;
                    userState.veAmount = 2500;
                    userState.claimableRewards = 125.50;
                }

                console.log('User state loaded:', userState);
            } catch (err) {
                console.error('Error fetching user data:', err);
                // Fall back to demo data
                userState = {
                    idlBalance: 10000.00,
                    stakedAmount: 5000.00,
                    veAmount: 2500.00,
                    claimableRewards: 125.50,
                    badges: ['early_adopter', 'first_stake', 'first_bet']
                };
            }
        }

        // Update UI with user state
        function updateUI() {
            if (connected) {
                document.getElementById('idlBalance').textContent = userState.idlBalance.toLocaleString();
                document.getElementById('stakedBalance').textContent = userState.stakedAmount.toLocaleString();
                document.getElementById('veBalance').textContent = userState.veAmount.toLocaleString();
                document.getElementById('badgeCount').textContent = `${userState.badges.length} / 12`;
                document.getElementById('claimableRewards').textContent = `${userState.claimableRewards.toFixed(2)} IDL`;
                document.getElementById('availableStake').textContent = `${userState.idlBalance.toLocaleString()} IDL`;
                document.getElementById('lockedStake').textContent = `${userState.stakedAmount.toLocaleString()} IDL`;
                document.getElementById('votingPower').textContent = userState.veAmount.toLocaleString();

                // Calculate staking bonus
                const bonus = Math.min((userState.stakedAmount / 1000000) * 50, 50);
                document.getElementById('stakingBonus').textContent = `${bonus.toFixed(1)}%`;
            } else {
                document.getElementById('idlBalance').textContent = '0.00';
                document.getElementById('stakedBalance').textContent = '0.00';
                document.getElementById('veBalance').textContent = '0.00';
                document.getElementById('badgeCount').textContent = '0 / 12';
                document.getElementById('claimableRewards').textContent = '0.00 IDL';
                document.getElementById('availableStake').textContent = '0.00 IDL';
                document.getElementById('lockedStake').textContent = '0.00 IDL';
                document.getElementById('votingPower').textContent = '0';
                document.getElementById('stakingBonus').textContent = '0%';
            }
        }

        // Staking functions
        function setMaxStake() {
            document.getElementById('stakeAmount').value = userState.idlBalance;
        }

        async function stakeTokens() {
            if (!connected) {
                showToast('Please connect your wallet first', 'error');
                return;
            }

            const amount = parseFloat(document.getElementById('stakeAmount').value);
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount', 'error');
                return;
            }

            if (amount > userState.idlBalance) {
                showToast('Insufficient balance', 'error');
                return;
            }

            showToast(`Staking ${amount.toLocaleString()} IDL...`, 'success');

            try {
                // Call SDK to stake
                const signature = await idlClient.stake(amount);
                console.log('Stake tx:', signature);

                userState.idlBalance -= amount;
                userState.stakedAmount += amount;
                document.getElementById('stakeAmount').value = '';
                updateUI();
                showToast(`Successfully staked ${amount.toLocaleString()} IDL!`, 'success');
            } catch (err) {
                console.error('Stake error:', err);
                // Demo mode fallback
                setTimeout(() => {
                    userState.idlBalance -= amount;
                    userState.stakedAmount += amount;
                    document.getElementById('stakeAmount').value = '';
                    updateUI();
                    showToast(`Staked ${amount.toLocaleString()} IDL (demo mode)`, 'success');
                }, 1000);
            }
        }

        async function unstakeTokens() {
            if (!connected) {
                showToast('Please connect your wallet first', 'error');
                return;
            }

            if (userState.stakedAmount <= 0) {
                showToast('No tokens to unstake', 'error');
                return;
            }

            showToast('Unstaking tokens...', 'success');

            setTimeout(() => {
                const amount = userState.stakedAmount;
                userState.idlBalance += amount;
                userState.stakedAmount = 0;
                updateUI();
                showToast(`Successfully unstaked ${amount.toLocaleString()} IDL!`, 'success');
            }, 1500);
        }

        async function lockTokens() {
            if (!connected) {
                showToast('Please connect your wallet first', 'error');
                return;
            }

            if (userState.stakedAmount <= 0) {
                showToast('Stake tokens first before locking', 'error');
                return;
            }

            const duration = document.getElementById('lockDuration').value;
            const multipliers = { '7': 1, '30': 1.5, '90': 2, '365': 3, '1460': 4 };
            const veAmount = userState.stakedAmount * multipliers[duration];

            showToast(`Locking for ${duration} days...`, 'success');

            setTimeout(() => {
                userState.veAmount = veAmount;
                updateUI();
                showToast(`Locked! You now have ${veAmount.toLocaleString()} veIDL`, 'success');
            }, 1500);
        }

        async function claimRewards() {
            if (!connected) {
                showToast('Please connect your wallet first', 'error');
                return;
            }

            if (userState.claimableRewards <= 0) {
                showToast('No rewards to claim', 'error');
                return;
            }

            showToast('Claiming rewards...', 'success');

            setTimeout(() => {
                const amount = userState.claimableRewards;
                userState.idlBalance += amount;
                userState.claimableRewards = 0;
                updateUI();
                showToast(`Claimed ${amount.toFixed(2)} IDL!`, 'success');
            }, 1500);
        }

        // Betting functions
        function placeBet(market, isYes) {
            if (!connected) {
                showToast('Please connect your wallet first', 'error');
                return;
            }

            // Set current bet state
            const marketData = marketsData[market];
            currentBet = {
                market: market,
                marketPDA: marketData.pda,
                betYes: isYes,
                yesPercent: marketData.yesPercent,
                noPercent: 100 - marketData.yesPercent,
                poolSize: marketData.poolSize
            };

            // Update modal
            document.getElementById('betModalTitle').textContent = `Bet on ${market.charAt(0).toUpperCase() + market.slice(1)}`;
            document.getElementById('betBalance').textContent = `${userState.idlBalance.toLocaleString()} IDL`;

            const bonus = Math.min((userState.stakedAmount / 1000000) * 50, 50);
            document.getElementById('betBonus').textContent = `+${bonus.toFixed(1)}%`;

            // Set initial side
            selectBetSide(isYes);

            // Show modal
            document.getElementById('betModal').classList.add('show');
        }

        function closeBetModal() {
            document.getElementById('betModal').classList.remove('show');
            document.getElementById('betAmount').value = '';
        }

        function selectBetSide(isYes) {
            currentBet.betYes = isYes;

            const yesBtn = document.getElementById('betYesBtn');
            const noBtn = document.getElementById('betNoBtn');

            if (isYes) {
                yesBtn.classList.add('active');
                noBtn.classList.remove('active');
            } else {
                noBtn.classList.add('active');
                yesBtn.classList.remove('active');
            }

            updateBetPreview();
        }

        function setMaxBet() {
            document.getElementById('betAmount').value = userState.idlBalance;
            updateBetPreview();
        }

        function updateBetPreview() {
            const amount = parseFloat(document.getElementById('betAmount').value) || 0;
            const bonus = Math.min((userState.stakedAmount / 1000000) * 50, 50);
            const effectiveAmount = amount * (1 + bonus / 100);

            document.getElementById('effectiveBet').textContent = `${effectiveAmount.toFixed(2)} IDL`;

            // Calculate potential payout
            const odds = currentBet.betYes ? (100 / currentBet.yesPercent) : (100 / currentBet.noPercent);
            const payout = effectiveAmount * odds * 0.97; // 3% fee

            document.getElementById('potentialPayout').textContent = `${payout.toFixed(2)} IDL`;
        }

        // Listen for bet amount changes
        document.getElementById('betAmount').addEventListener('input', updateBetPreview);

        async function confirmBet() {
            const amount = parseFloat(document.getElementById('betAmount').value);

            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount', 'error');
                return;
            }

            if (amount > userState.idlBalance) {
                showToast('Insufficient balance', 'error');
                return;
            }

            const side = currentBet.betYes ? 'YES' : 'NO';
            showToast(`Placing ${side} bet on ${currentBet.market}...`, 'success');

            try {
                // Call SDK to place bet
                const signature = await idlClient.placeBet(currentBet.marketPDA, amount, currentBet.betYes);
                console.log('Bet tx:', signature);

                userState.idlBalance -= amount;
                closeBetModal();
                updateUI();
                showToast(`${side} bet placed on ${currentBet.market}!`, 'success');
            } catch (err) {
                console.error('Bet error:', err);
                // Demo mode fallback
                setTimeout(() => {
                    userState.idlBalance -= amount;
                    closeBetModal();
                    updateUI();
                    showToast(`${side} bet placed on ${currentBet.market} (demo mode)`, 'success');
                }, 1000);
            }
        }

        function createMarket() {
            if (!connected) {
                showToast('Please connect your wallet first', 'error');
                return;
            }

            // Set default date to 7 days from now
            const defaultDate = new Date();
            defaultDate.setDate(defaultDate.getDate() + 7);
            document.getElementById('marketResolutionDate').value = defaultDate.toISOString().split('T')[0];

            document.getElementById('createMarketModal').classList.add('show');
        }

        function closeCreateMarketModal() {
            document.getElementById('createMarketModal').classList.remove('show');
        }

        async function confirmCreateMarket() {
            const protocolId = document.getElementById('marketProtocol').value;
            const metricType = parseInt(document.getElementById('marketMetricType').value);
            const targetValue = parseFloat(document.getElementById('marketTargetValue').value);
            const resolutionDate = new Date(document.getElementById('marketResolutionDate').value);
            const description = document.getElementById('marketDescription').value;

            if (!targetValue || !description) {
                showToast('Please fill in all fields', 'error');
                return;
            }

            const resolutionTimestamp = Math.floor(resolutionDate.getTime() / 1000);

            showToast(`Creating market for ${protocolId}...`, 'success');

            try {
                const signature = await idlClient.createMarket(
                    protocolId,
                    metricType,
                    targetValue,
                    resolutionTimestamp,
                    description
                );
                console.log('Create market tx:', signature);

                closeCreateMarketModal();
                showToast(`Market created for ${protocolId}!`, 'success');
            } catch (err) {
                console.error('Create market error:', err);
                // Demo mode fallback
                setTimeout(() => {
                    closeCreateMarketModal();
                    showToast(`Market created for ${protocolId} (demo mode)`, 'success');
                }, 1000);
            }
        }

        // Voting functions
        function openProposal(id) {
            showToast(`Opening proposal IDP-${id}...`, 'success');
            // Would open a detailed proposal view/voting modal
        }

        // veIDL preview
        document.getElementById('lockDuration').addEventListener('change', function() {
            const multipliers = { '7': 1, '30': 1.5, '90': 2, '365': 3, '1460': 4 };
            const veAmount = userState.stakedAmount * multipliers[this.value];
            document.getElementById('veIdlPreview').textContent = `${veAmount.toLocaleString()} veIDL`;
        });

        // Close modals on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('show');
                }
            });
        });

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Load protocol metrics from API
        async function loadProtocolMetrics() {
            try {
                const response = await fetch('/api/metrics');
                const data = await response.json();

                // Convert protocols object to array with id field
                const protocols = data.protocols || {};
                return Object.keys(protocols).map(id => ({
                    id: id,
                    name: id.charAt(0).toUpperCase() + id.slice(1),
                    ...protocols[id]
                }));
            } catch (err) {
                console.error('Error loading protocol metrics:', err);
                return [];
            }
        }

        // Generate prediction markets from metrics
        function generateMarketsFromMetrics(metrics) {
            const marketsContainer = document.getElementById('marketsContainer');

            // Filter protocols with real metrics (users > 0)
            const activeProtocols = metrics.filter(m =>
                m.users && m.users > 0
            );

            if (activeProtocols.length === 0) {
                marketsContainer.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-muted);">
                        <p>No active protocols with metrics found. Check back soon!</p>
                    </div>
                `;
                return;
            }

            // Generate markets for each protocol
            const formatTVL = (v) => {
                if (v >= 1e9) return '$' + (v / 1e9).toFixed(2) + 'B';
                if (v >= 1e6) return '$' + (v / 1e6).toFixed(1) + 'M';
                if (v >= 1e3) return '$' + (v / 1e3).toFixed(0) + 'K';
                return '$' + v.toFixed(0);
            };

            const marketTypes = [
                { type: 'users', multiplier: 1.2, label: 'users', format: (v) => Math.ceil(v).toLocaleString() },
                { type: 'tvl', multiplier: 1.3, label: 'TVL', format: formatTVL },
                { type: 'accounts', multiplier: 1.5, label: 'accounts', format: (v) => Math.ceil(v).toLocaleString() }
            ];

            const markets = [];

            activeProtocols.forEach(protocol => {
                // Pick appropriate market types based on available metrics
                const availableTypes = [];

                if (protocol.users && protocol.users > 0) {
                    availableTypes.push(marketTypes[0]);
                }
                if (protocol.tvl && protocol.tvl > 0) {
                    availableTypes.push(marketTypes[1]);
                }
                if (protocol.accounts && protocol.accounts > 0) {
                    availableTypes.push(marketTypes[2]);
                }

                // Create one market per protocol (pick most interesting metric)
                if (availableTypes.length > 0) {
                    const marketType = availableTypes[0]; // Use first available metric
                    const currentValue = protocol[marketType.type];
                    const targetValue = currentValue * marketType.multiplier;

                    // Generate realistic odds (skewed based on target difficulty)
                    const baseOdds = 50;
                    const variance = Math.floor(Math.random() * 30) - 15; // -15 to +15
                    const yesOdds = Math.max(25, Math.min(75, baseOdds + variance));

                    // Generate random pool size based on protocol popularity
                    const basePool = 50000;
                    const poolVariance = Math.floor(Math.random() * 100000);
                    const poolSize = basePool + poolVariance;

                    // Generate random time left (1-7 days)
                    const daysLeft = Math.floor(Math.random() * 7) + 1;
                    const hoursLeft = Math.floor(Math.random() * 24);

                    // Get protocol icon/abbreviation
                    const icon = getProtocolIcon(protocol.name || protocol.id);
                    const metricLabel = marketType.label.toUpperCase();

                    markets.push({
                        protocol: protocol.name || protocol.id,
                        protocolId: protocol.id,
                        icon: icon,
                        metric: metricLabel,
                        question: `Will ${protocol.name || protocol.id} exceed ${marketType.format(targetValue)} ${marketType.label} next month?`,
                        yesOdds: yesOdds,
                        noOdds: 100 - yesOdds,
                        poolSize: poolSize,
                        daysLeft: daysLeft,
                        hoursLeft: hoursLeft,
                        currentValue: currentValue,
                        targetValue: targetValue
                    });
                }
            });

            // Render markets
            if (markets.length === 0) {
                marketsContainer.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-muted);">
                        <p>No markets could be generated from current metrics.</p>
                    </div>
                `;
                return;
            }

            marketsContainer.innerHTML = markets.map(market => `
                <div class="market-card">
                    <div class="market-header">
                        <div class="market-protocol">
                            <div class="protocol-icon">${market.icon}</div>
                            <div>
                                <div class="protocol-name">${market.protocol}</div>
                                <div class="market-metric">${market.metric} Target</div>
                            </div>
                        </div>
                        <div class="market-timer">
                            <div class="live-dot"></div>
                            ${market.daysLeft}d ${market.hoursLeft}h left
                        </div>
                    </div>
                    <div class="market-question">${market.question}</div>
                    <div class="market-odds">
                        <button class="odds-btn yes" onclick="placeBet('${market.protocolId}', true)">
                            <div class="odds-label">YES</div>
                            <div class="odds-value">${market.yesOdds}%</div>
                        </button>
                        <button class="odds-btn no" onclick="placeBet('${market.protocolId}', false)">
                            <div class="odds-label">NO</div>
                            <div class="odds-value">${market.noOdds}%</div>
                        </button>
                    </div>
                    <div class="market-pool">
                        <span>Pool: ${market.poolSize.toLocaleString()} IDL</span>
                        <span>Your position: --</span>
                    </div>
                </div>
            `).join('');

            // Update markets data for betting
            markets.forEach(market => {
                if (!marketsData[market.protocolId]) {
                    marketsData[market.protocolId] = {
                        pda: generateFakePDA(market.protocolId),
                        yesPercent: market.yesOdds,
                        poolSize: market.poolSize
                    };
                }
            });
        }

        // Get protocol icon/abbreviation
        function getProtocolIcon(name) {
            const icons = {
                'jupiter': 'JUP',
                'raydium': 'RAY',
                'marinade': 'MNDE',
                'orca': 'ORCA',
                'drift': 'DRIFT',
                'pyth': 'PYTH',
                'tensor': 'TNSR',
                'magic-eden': 'ME',
                'solend': 'SLND',
                'mango': 'MNGO',
                'serum': 'SRM',
                'saber': 'SBR',
                'kamino': 'KMNO',
                'jito': 'JTO',
                'meteora': 'MET',
                'phoenix': 'PHX',
                'zeta': 'Z',
                'marginfi': 'MRGN',
                'sanctum': 'SCT',
                'streamflow': 'SF'
            };

            const key = name.toLowerCase().replace(/[^a-z]/g, '');
            if (icons[key]) {
                return icons[key];
            }

            // Generate abbreviation from name
            const words = name.split(/[\s-_]/);
            if (words.length > 1) {
                return words.map(w => w[0]).join('').toUpperCase().slice(0, 4);
            }
            return name.slice(0, 3).toUpperCase();
        }

        // Generate fake PDA for demo (in production, this would be real on-chain PDAs)
        function generateFakePDA(protocolId) {
            // Simple hash to generate consistent fake PDA
            let hash = 0;
            for (let i = 0; i < protocolId.length; i++) {
                hash = ((hash << 5) - hash) + protocolId.charCodeAt(i);
                hash = hash & hash;
            }
            const base58 = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz123456789';
            let pda = '';
            for (let i = 0; i < 44; i++) {
                pda += base58[Math.abs(hash + i) % base58.length];
            }
            return pda;
        }

        // Load and render markets on page load
        async function initializeMarkets() {
            const metrics = await loadProtocolMetrics();
            generateMarketsFromMetrics(metrics);
        }

        // Load protocol stats for the header
        async function loadProtocolStats() {
            try {
                const response = await fetch('/api/idl');
                const data = await response.json();
                const protocols = data.idls || [];

                const totalCount = protocols.length;
                const availableCount = protocols.filter(p => p.idl_available).length;

                document.getElementById('totalProtocols').textContent = totalCount;
                document.getElementById('availableProtocols').textContent = availableCount;
                document.getElementById('selectedCount').textContent = '0';
            } catch (err) {
                console.error('Error loading protocol stats:', err);
                // Fallback to placeholder values
                document.getElementById('totalProtocols').textContent = '-';
                document.getElementById('availableProtocols').textContent = '-';
                document.getElementById('selectedCount').textContent = '0';
            }
        }

        // Initialize
        loadProtocolStats();
        initializeMarkets();
        updateUI();

        // Log SDK availability
        console.log('IDL Protocol App loaded');
        console.log('SDK available:', typeof IdlBrowserClient !== 'undefined');

        // Hash routing functionality
        let hashProtocolId = null;

        function handleHashRoute() {
            const hash = window.location.hash;

            if (!hash) {
                hashProtocolId = null;
                return;
            }

            // Check if hash matches #bet-{protocolId} pattern
            const betMatch = hash.match(/^#bet-(.+)$/);
            if (betMatch) {
                hashProtocolId = betMatch[1];
                console.log('Hash routing: Opening bet tab for protocol:', hashProtocolId);

                // Switch to the Bet tab
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                // Show bet tab
                document.getElementById('tab-bet').classList.add('active');
                const betTabBtn = document.querySelector('.tab-btn[onclick*="bet"]');
                if (betTabBtn) {
                    betTabBtn.classList.add('active');
                }

                // Optionally highlight/filter markets for this protocol
                highlightProtocolMarket(hashProtocolId);
            }
        }

        function highlightProtocolMarket(protocolId) {
            // Remove any existing highlights
            document.querySelectorAll('.market-card').forEach(card => {
                card.style.border = '';
                card.style.background = '';
            });

            // Find and highlight markets matching the protocol
            // The protocol names in the DOM are in title case (e.g., "Jupiter", "Raydium")
            const marketCards = document.querySelectorAll('.market-card');
            let found = false;

            marketCards.forEach(card => {
                const protocolNameEl = card.querySelector('.protocol-name');
                if (protocolNameEl) {
                    const cardProtocol = protocolNameEl.textContent.toLowerCase();
                    const targetProtocol = protocolId.toLowerCase();

                    if (cardProtocol === targetProtocol || cardProtocol.includes(targetProtocol) || targetProtocol.includes(cardProtocol)) {
                        // Highlight this card
                        card.style.border = '2px solid var(--accent-primary)';
                        card.style.background = 'var(--bg-tertiary)';

                        // Scroll into view
                        setTimeout(() => {
                            card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }, 100);

                        found = true;
                    }
                }
            });

            if (found) {
                showToast(`Showing markets for ${protocolId}`, 'success');
            } else {
                console.log(`No markets found for protocol: ${protocolId}`);
            }
        }

        // Listen for hash changes
        window.addEventListener('hashchange', handleHashRoute);

        // Handle hash on page load
        window.addEventListener('DOMContentLoaded', handleHashRoute);

        // Also handle it immediately in case DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            // DOMContentLoaded hasn't fired yet
        } else {
            // DOMContentLoaded has already fired, handle hash now
            handleHashRoute();
        }
    </script>
</body>

</html>
