{
  "version": "0.1.0",
  "name": "idl_protocol",
  "constants": [
    { "name": "IDL_TOKEN_MINT", "type": "string", "value": "8zdhHxthCFoigAGw4QRxWfXUWLY1KkMZ1r7CTcmiBAGS" },
    { "name": "MAX_LOCK_DURATION", "type": "i64", "value": "126144000" },
    { "name": "MIN_LOCK_DURATION", "type": "i64", "value": "604800" },
    { "name": "BET_FEE_BPS", "type": "u64", "value": "300" },
    { "name": "STAKER_FEE_SHARE_BPS", "type": "u64", "value": "5000" },
    { "name": "CREATOR_FEE_SHARE_BPS", "type": "u64", "value": "2500" },
    { "name": "TREASURY_FEE_SHARE_BPS", "type": "u64", "value": "1500" },
    { "name": "BURN_FEE_SHARE_BPS", "type": "u64", "value": "1000" }
  ],
  "instructions": [
    {
      "name": "initialize",
      "docs": ["Initialize the protocol - call once"],
      "accounts": [
        { "name": "state", "isMut": true, "isSigner": false },
        { "name": "idl_mint", "isMut": false, "isSigner": false, "docs": ["Must be the actual $IDL token mint"] },
        { "name": "treasury", "isMut": false, "isSigner": false },
        { "name": "authority", "isMut": true, "isSigner": true },
        { "name": "system_program", "isMut": false, "isSigner": false }
      ],
      "args": []
    },
    {
      "name": "deposit_rewards",
      "docs": ["Deposit IDL tokens into reward pool for stakers"],
      "accounts": [
        { "name": "state", "isMut": true, "isSigner": false },
        { "name": "depositor", "isMut": true, "isSigner": true },
        { "name": "depositor_idl", "isMut": true, "isSigner": false },
        { "name": "reward_vault", "isMut": true, "isSigner": false },
        { "name": "token_program", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "amount", "type": "u64" }
      ]
    },
    {
      "name": "stake",
      "docs": ["Stake IDL tokens to earn share of reward pool"],
      "accounts": [
        { "name": "state", "isMut": true, "isSigner": false },
        { "name": "staker_account", "isMut": true, "isSigner": false },
        { "name": "user", "isMut": true, "isSigner": true },
        { "name": "user_idl", "isMut": true, "isSigner": false },
        { "name": "stake_vault", "isMut": true, "isSigner": false },
        { "name": "system_program", "isMut": false, "isSigner": false },
        { "name": "token_program", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "amount", "type": "u64" }
      ]
    },
    {
      "name": "unstake",
      "docs": ["Unstake IDL tokens + claim proportional rewards"],
      "accounts": [
        { "name": "state", "isMut": true, "isSigner": false },
        { "name": "staker_account", "isMut": true, "isSigner": false },
        { "name": "user", "isMut": true, "isSigner": true },
        { "name": "user_idl", "isMut": true, "isSigner": false },
        { "name": "stake_vault", "isMut": true, "isSigner": false },
        { "name": "reward_vault", "isMut": true, "isSigner": false },
        { "name": "token_program", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "amount", "type": "u64" }
      ]
    },
    {
      "name": "lock_for_ve",
      "docs": ["Lock staked IDL for veIDL voting power (min 1 week, max 4 years)"],
      "accounts": [
        { "name": "state", "isMut": true, "isSigner": false },
        { "name": "staker_account", "isMut": false, "isSigner": false },
        { "name": "ve_position", "isMut": true, "isSigner": false },
        { "name": "user", "isMut": true, "isSigner": true },
        { "name": "system_program", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "lock_duration", "type": "i64" }
      ]
    },
    {
      "name": "unlock_ve",
      "docs": ["Unlock expired veIDL position"],
      "accounts": [
        { "name": "state", "isMut": true, "isSigner": false },
        { "name": "ve_position", "isMut": true, "isSigner": false },
        { "name": "user", "isMut": true, "isSigner": true }
      ],
      "args": []
    },
    {
      "name": "create_market",
      "docs": ["Create a prediction market for protocol metrics"],
      "accounts": [
        { "name": "market", "isMut": true, "isSigner": false },
        { "name": "creator", "isMut": true, "isSigner": true },
        { "name": "oracle", "isMut": false, "isSigner": false, "docs": ["Authorized oracle to resolve this market"] },
        { "name": "system_program", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "protocol_id", "type": "string" },
        { "name": "metric_type", "type": { "defined": "MetricType" } },
        { "name": "target_value", "type": "u64" },
        { "name": "resolution_timestamp", "type": "i64" },
        { "name": "description", "type": "string" }
      ]
    },
    {
      "name": "place_bet",
      "docs": ["Place a YES/NO bet on prediction market. Staking boosts effective amount."],
      "accounts": [
        { "name": "market", "isMut": true, "isSigner": false },
        { "name": "bet", "isMut": true, "isSigner": false },
        { "name": "staker_account", "isMut": false, "isSigner": false },
        { "name": "user", "isMut": true, "isSigner": true },
        { "name": "user_idl", "isMut": true, "isSigner": false },
        { "name": "market_pool", "isMut": true, "isSigner": false },
        { "name": "system_program", "isMut": false, "isSigner": false },
        { "name": "token_program", "isMut": false, "isSigner": false }
      ],
      "args": [
        { "name": "amount", "type": "u64" },
        { "name": "bet_yes", "type": "bool" }
      ]
    },
    {
      "name": "resolve_market",
      "docs": ["Resolve market with actual value - only authorized oracle"],
      "accounts": [
        { "name": "market", "isMut": true, "isSigner": false },
        { "name": "oracle", "isMut": false, "isSigner": true }
      ],
      "args": [
        { "name": "actual_value", "type": "u64" }
      ]
    },
    {
      "name": "claim_winnings",
      "docs": ["Claim winnings from resolved market. 3% fee: 50% stakers, 25% creator, 15% treasury, 10% burned"],
      "accounts": [
        { "name": "state", "isMut": true, "isSigner": false },
        { "name": "market", "isMut": false, "isSigner": false },
        { "name": "bet", "isMut": true, "isSigner": false },
        { "name": "user", "isMut": false, "isSigner": true },
        { "name": "user_idl", "isMut": true, "isSigner": false },
        { "name": "market_pool", "isMut": true, "isSigner": false },
        { "name": "reward_vault", "isMut": true, "isSigner": false },
        { "name": "creator_idl", "isMut": true, "isSigner": false },
        { "name": "treasury", "isMut": true, "isSigner": false },
        { "name": "idl_mint", "isMut": true, "isSigner": false },
        { "name": "token_program", "isMut": false, "isSigner": false }
      ],
      "args": []
    },
    {
      "name": "set_paused",
      "docs": ["Emergency pause/unpause - admin only"],
      "accounts": [
        { "name": "state", "isMut": true, "isSigner": false },
        { "name": "authority", "isMut": false, "isSigner": true }
      ],
      "args": [
        { "name": "paused", "type": "bool" }
      ]
    },
    {
      "name": "transfer_authority",
      "docs": ["Transfer admin authority - admin only"],
      "accounts": [
        { "name": "state", "isMut": true, "isSigner": false },
        { "name": "authority", "isMut": false, "isSigner": true }
      ],
      "args": [
        { "name": "new_authority", "type": "publicKey" }
      ]
    }
  ],
  "accounts": [
    {
      "name": "ProtocolState",
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "authority", "type": "publicKey" },
          { "name": "treasury", "type": "publicKey" },
          { "name": "idl_mint", "type": "publicKey" },
          { "name": "total_staked", "type": "u64" },
          { "name": "total_ve_supply", "type": "u64" },
          { "name": "reward_pool", "type": "u64", "docs": ["Accumulated fees for stakers"] },
          { "name": "total_fees_collected", "type": "u64" },
          { "name": "total_burned", "type": "u64" },
          { "name": "bump", "type": "u8" },
          { "name": "paused", "type": "bool" }
        ]
      }
    },
    {
      "name": "StakerAccount",
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "owner", "type": "publicKey" },
          { "name": "staked_amount", "type": "u64" },
          { "name": "last_stake_timestamp", "type": "i64" },
          { "name": "bump", "type": "u8" }
        ]
      }
    },
    {
      "name": "VePosition",
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "owner", "type": "publicKey" },
          { "name": "locked_stake", "type": "u64", "docs": ["Amount of staked IDL locked"] },
          { "name": "ve_amount", "type": "u64" },
          { "name": "lock_start", "type": "i64" },
          { "name": "lock_end", "type": "i64" },
          { "name": "bump", "type": "u8" }
        ]
      }
    },
    {
      "name": "PredictionMarket",
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "creator", "type": "publicKey" },
          { "name": "protocol_id", "type": "string" },
          { "name": "metric_type", "type": { "defined": "MetricType" } },
          { "name": "target_value", "type": "u64" },
          { "name": "resolution_timestamp", "type": "i64" },
          { "name": "description", "type": "string" },
          { "name": "total_yes_amount", "type": "u64" },
          { "name": "total_no_amount", "type": "u64" },
          { "name": "resolved", "type": "bool" },
          { "name": "outcome", "type": { "option": "bool" } },
          { "name": "actual_value", "type": { "option": "u64" } },
          { "name": "oracle", "type": "publicKey", "docs": ["Authorized oracle"] },
          { "name": "created_at", "type": "i64" },
          { "name": "bump", "type": "u8" }
        ]
      }
    },
    {
      "name": "Bet",
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "owner", "type": "publicKey" },
          { "name": "market", "type": "publicKey" },
          { "name": "amount", "type": "u64" },
          { "name": "effective_amount", "type": "u64", "docs": ["After staking multiplier"] },
          { "name": "bet_yes", "type": "bool" },
          { "name": "timestamp", "type": "i64" },
          { "name": "claimed", "type": "bool" },
          { "name": "bump", "type": "u8" }
        ]
      }
    }
  ],
  "types": [
    {
      "name": "MetricType",
      "type": {
        "kind": "enum",
        "variants": [
          { "name": "Tvl" },
          { "name": "Volume24h" },
          { "name": "Users" },
          { "name": "Transactions" },
          { "name": "Price" },
          { "name": "MarketCap" },
          { "name": "Custom" }
        ]
      }
    }
  ],
  "errors": [
    { "code": 6000, "name": "InvalidAmount", "msg": "Invalid amount" },
    { "code": 6001, "name": "InvalidLockDuration", "msg": "Invalid lock duration (min 1 week, max 4 years)" },
    { "code": 6002, "name": "LockNotExpired", "msg": "Lock not expired" },
    { "code": 6003, "name": "InsufficientStake", "msg": "Insufficient stake" },
    { "code": 6004, "name": "InvalidInput", "msg": "Invalid input" },
    { "code": 6005, "name": "InvalidTimestamp", "msg": "Invalid timestamp" },
    { "code": 6006, "name": "MarketResolved", "msg": "Market already resolved" },
    { "code": 6007, "name": "MarketNotResolved", "msg": "Market not resolved" },
    { "code": 6008, "name": "BettingClosed", "msg": "Betting closed" },
    { "code": 6009, "name": "ResolutionTooEarly", "msg": "Resolution too early" },
    { "code": 6010, "name": "AlreadyClaimed", "msg": "Already claimed" },
    { "code": 6011, "name": "Unauthorized", "msg": "Unauthorized" },
    { "code": 6012, "name": "InvalidMint", "msg": "Invalid mint - must use $IDL token" },
    { "code": 6013, "name": "ProtocolPaused", "msg": "Protocol is paused" }
  ],
  "metadata": {
    "address": "IDLStake11111111111111111111111111111111111",
    "origin": "bags.fm",
    "token": "8zdhHxthCFoigAGw4QRxWfXUWLY1KkMZ1r7CTcmiBAGS"
  }
}
